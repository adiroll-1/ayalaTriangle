<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>×—×–×¨×•×ª: ×–×•×•×™×•×ª ×•××©×•×œ×©×™×</title>
<style>
  body{font-family:Arial; background:#f5f7fa; margin:0; padding:16px; text-align:center;}
  h1{margin:8px 0 14px;}
  .wrap{max-width:920px; margin:0 auto;}
  .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; align-items:center;}
  .card{background:#fff; border-radius:14px; padding:14px; margin:12px auto; box-shadow:0 2px 10px rgba(0,0,0,.08);}
  button{padding:10px 14px; font-size:16px; border-radius:10px; border:1px solid #d7dce3; background:#fff; cursor:pointer;}
  button.primary{background:#1f6feb; color:#fff; border-color:#1f6feb;}
  button:disabled{opacity:.45; cursor:not-allowed;}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#eef2ff; margin:6px 4px; font-size:14px;}
  .big{font-size:72px; line-height:1; margin:6px 0;}
  .hint{color:#444; margin:6px 0;}
  .muted{color:#6b7280; font-size:14px;}
  .sep{height:1px; background:#eef1f5; margin:12px 0;}
  .grid{display:grid; gap:10px; grid-template-columns:repeat(auto-fit, minmax(170px, 1fr));}
  .choice{padding:12px; border-radius:12px; border:1px solid #d7dce3; background:#fff;}
  .choice:hover{border-color:#1f6feb;}
  .status{font-size:18px; margin-top:8px; min-height:26px;}
  input[type="text"]{
    font-size:18px; padding:10px 12px; border-radius:10px;
    border:1px solid #d7dce3; width:min(520px, 92%);
    text-align:center;
  }
  .kbd{font-family:monospace; background:#f1f5f9; padding:2px 6px; border-radius:6px;}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ“ ×—×–×¨×•×ª: ×–×•×•×™×•×ª ×•××©×•×œ×©×™× (×œ×—×™×¦×” + ×›×ª×™×‘×”)</h1>

  <div class="card">
    <div class="row">
      <button class="primary" onclick="show('learn')">ğŸ“˜ ×œ×™××•×“ ×§×¦×¨</button>
      <button class="primary" onclick="show('menu')">ğŸ® ××©×—×§×™×</button>
      <button onclick="resetProgress()">ğŸ” ××™×¤×•×¡ × ×™×§×•×“</button>
    </div>
    <div class="sep"></div>
    <div class="row">
      <span class="pill">× ×™×§×•×“: <b id="score">0</b></span>
      <span class="pill">×¨×¦×£ × ×›×•×Ÿ: <b id="streak">0</b> ğŸ”¥</span>
      <span class="pill">×©××œ×”: <b id="qnum">0</b>/<b id="qmax">0</b></span>
      <span class="pill">×˜×¢×•×™×•×ª ×œ×©×—×–×•×¨: <b id="mist">0</b></span>
    </div>
    <p class="muted">×˜×™×¤: ×¢×©×™ ×¡×˜ 20 â†’ ×•××– â€œ×—×–×¨×•×ª ×¢×œ ×˜×¢×•×™×•×ªâ€ â†’ ×•××– ×¡×˜ 20 ×¢× ×›×ª×™×‘×”.</p>
  </div>

  <!-- ×œ×™××•×“ -->
  <div id="learn" class="card" style="display:none;">
    <h2>ğŸ“˜ ×œ×™××•×“ ×§×¦×¨ (×¨×§ ××” ×©×¦×¨×™×š ×œ×–×›×•×¨)</h2>

    <h3>ğŸ“ ×–×•×•×™×•×ª</h3>
    <p><b>×–×•×•×™×ª ×—×“×”</b> â€” ×§×˜× ×” ×Ö¾90Â° (×›××• <b>×—×¥</b>)</p>
    <p><b>×–×•×•×™×ª ×™×©×¨×”</b> â€” ×‘×“×™×•×§ 90Â° (×›××• <b>×¤×™× ×” ×©×œ ××—×‘×¨×ª</b>)</p>
    <p><b>×–×•×•×™×ª ×§×”×”</b> â€” ×’×“×•×œ×” ×Ö¾90Â° (×›××• <b>×¤×” ×¤×ª×•×— ×’×“×•×œ</b>)</p>

    <h3>ğŸ”º ××©×•×œ×©×™× ×œ×¤×™ ×¦×œ×¢×•×ª</h3>
    <p><b>×©×•×•×” ×¦×œ×¢×•×ª</b> â€” 3 ×¦×œ×¢×•×ª ×©×•×•×ª (×©×œ×•×©×” ×—×‘×¨×™× ×–×”×™×)</p>
    <p><b>×©×•×•×” ×©×•×§×™×™×</b> â€” 2 ×¦×œ×¢×•×ª ×©×•×•×ª (×©×ª×™ ×¨×’×œ×™×™× ×©×•×•×ª)</p>
    <p><b>×©×•× ×” ×¦×œ×¢×•×ª</b> â€” ×›×œ ×”×¦×œ×¢×•×ª ×©×•× ×•×ª (×›×œ ××—×“ ×©×•× ×”)</p>

    <div class="sep"></div>
    <button class="primary" onclick="show('menu')">×™××œ×œ×” ×œ××©×—×§×™× ğŸ®</button>
  </div>

  <!-- ×ª×¤×¨×™×˜ -->
  <div id="menu" class="card">
    <h2>ğŸ® ×‘×•×—×¨×™× ××©×—×§</h2>

    <div class="row">
      <label class="pill">××•×¨×š ×¡×˜:
        <select id="setSize" onchange="updateSetSize()">
          <option value="10">10</option>
          <option value="20" selected>20</option>
          <option value="30">30</option>
        </select>
      </label>

      <label class="pill">× ×•×©×:
        <select id="topic" onchange="updateTopic()">
          <option value="mix" selected>××¢×•×¨×‘</option>
          <option value="angles">×–×•×•×™×•×ª</option>
          <option value="triangles">××©×•×œ×©×™×</option>
        </select>
      </label>

      <label class="pill">××¦×‘ ××‘×—×Ÿ:
        <select id="examMode" onchange="updateExamMode()">
          <option value="off" selected>×›×‘×•×™</option>
          <option value="on">×“×•×œ×§</option>
        </select>
      </label>
    </div>

    <div class="grid" style="margin-top:10px;">
      <!-- ×œ×—×™×¦×” -->
      <button class="choice" onclick="startGame('mcq')">1) ×œ×—×™×¦×”: ××” ×–×”? (×¨×‘Ö¾×‘×¨×™×¨×”)</button>
      <button class="choice" onclick="startGame('tf')">2) ×œ×—×™×¦×”: × ×›×•×Ÿ / ×œ× × ×›×•×Ÿ</button>
      <button class="choice" onclick="startGame('match')">3) ×œ×—×™×¦×”: ×”×ª×××” ×©× â†” ×¦×™×•×¨</button>

      <!-- ×›×ª×™×‘×” -->
      <button class="choice" onclick="startGame('type')">4) ×›×ª×™×‘×”: ×›×ª×‘×™ ××ª ×”×©×</button>
      <button class="choice" onclick="startGame('fill')">5) ×›×ª×™×‘×”: ×”×©×œ×™××™ ××™×œ×” ×‘××©×¤×˜</button>

      <!-- ×˜×¢×•×™×•×ª -->
      <button class="choice" onclick="startMistakeReview()">6) ×—×–×¨×•×ª ×¢×œ ×˜×¢×•×™×•×ª</button>
    </div>

    <p class="muted" id="mistakeTip">××™×Ÿ ×¢×“×™×™×Ÿ ×˜×¢×•×™×•×ª ×œ×©×—×–×•×¨ â€” ×©×—×§×™ ×¡×˜ ×¨××©×•×Ÿ ğŸ™‚</p>
    <p class="muted">×‘â€××¦×‘ ××‘×—×Ÿâ€ ×¨××–×™×/×ª×©×•×‘×” ×™×•×¤×™×¢×• ×¨×§ <b>××—×¨×™ ×˜×¢×•×ª</b> (×›×“×™ ×œ×—×–×§ ×©×œ×™×¤×”).</p>
  </div>

  <!-- ××©×—×§ -->
  <div id="game" class="card" style="display:none;">
    <h2 id="gameTitle">××©×—×§</h2>

    <div id="promptBox">
      <div class="big" id="symbol">âŒŸ</div>
      <div class="hint" id="prompt">××™×–×” ×¡×•×’ ×–×”?</div>
    </div>

    <!-- ××–×•×¨ ×œ×—×™×¦×•×ª -->
    <div id="choices" class="grid" style="margin-top:10px;"></div>

    <!-- ××–×•×¨ ×›×ª×™×‘×” -->
    <div id="typingArea" style="display:none; margin-top:10px;">
      <input id="answerInput" type="text" placeholder="×›×ª×‘×™ ×›××Ÿâ€¦" autocomplete="off" />
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="submitTyped()">×‘×“×™×§×” âœ…</button>
        <button id="hintBtn" onclick="giveHint()">×¨××– ğŸ’¡</button>
        <button id="showBtn" onclick="showAnswer()">×”×¦×’ ×ª×©×•×‘×” ğŸ‘€</button>
      </div>
      <p class="muted" id="hintBox"></p>
      <p class="muted" id="examNote" style="display:none;">××¦×‘ ××‘×—×Ÿ ×¤×¢×™×œ: ×¨××–/×ª×©×•×‘×” ×™×•×¤×™×¢×• ×¨×§ ××—×¨×™ ×˜×¢×•×ª.</p>
    </div>

    <div class="status" id="status"></div>

    <div class="sep"></div>
    <div class="row">
      <button onclick="backToMenu()">â¬…ï¸ ×œ×ª×¤×¨×™×˜</button>
      <button class="primary" id="nextBtn" onclick="nextQuestion()">×©××œ×” ×”×‘××” â¡ï¸</button>
    </div>

    <p class="muted" id="extraInfo"></p>
  </div>
</div>

<script>
/* ---------- ×ª×•×›×Ÿ ---------- */
const ANGLES = [
  { id:"a_acute", type:"angles", label:"×—×“×”", symbol:"âˆ ", prompt:"×–×•×•×™×ª ×§×˜× ×” ×Ö¾90Â° ×”×™×â€¦", fact:"×—×“×” = ×—×¥, ×§×˜× ×” ×Ö¾90Â°" },
  { id:"a_right", type:"angles", label:"×™×©×¨×”", symbol:"âŒŸ", prompt:"×–×•×•×™×ª ×©×”×™× ×‘×“×™×•×§ 90Â° ×”×™×â€¦", fact:"×™×©×¨×” = ×¤×™× ×”, 90Â°" },
  { id:"a_obtuse", type:"angles", label:"×§×”×”", symbol:"â¦œ", prompt:"×–×•×•×™×ª ×’×“×•×œ×” ×Ö¾90Â° ×”×™×â€¦", fact:"×§×”×” = ×¤×” ×¤×ª×•×—, ×’×“×•×œ×” ×Ö¾90Â°" }
];

const TRIANGLES = [
  { id:"t_equilateral", type:"triangles", label:"×©×•×•×” ×¦×œ×¢×•×ª", symbol:"â–³", prompt:"××©×•×œ×© ×¢× 3 ×¦×œ×¢×•×ª ×©×•×•×ª ×”×•×â€¦", fact:"×©×•×•×” ×¦×œ×¢×•×ª = 3 ×©×•×•×ª" },
  { id:"t_isosceles", type:"triangles", label:"×©×•×•×” ×©×•×§×™×™×", symbol:"ğŸ”º", prompt:"××©×•×œ×© ×¢× 2 ×¦×œ×¢×•×ª ×©×•×•×ª ×”×•×â€¦", fact:"×©×•×•×” ×©×•×§×™×™× = 2 ×©×•×•×ª" },
  { id:"t_scalene", type:"triangles", label:"×©×•× ×” ×¦×œ×¢×•×ª", symbol:"â–²", prompt:"××©×•×œ×© ×©×›×œ ×”×¦×œ×¢×•×ª ×©×•× ×•×ª ×”×•×â€¦", fact:"×©×•× ×” ×¦×œ×¢×•×ª = ×›×•×œ×Ÿ ×©×•× ×•×ª" }
];

const TRUE_FALSE = [
  { topic:"angles", text:"×–×•×•×™×ª ×™×©×¨×” ×”×™× 90Â°.", answer:true, explain:"× ×›×•×Ÿ. ×™×©×¨×” = 90Â°." },
  { topic:"angles", text:"×–×•×•×™×ª ×—×“×” ×’×“×•×œ×” ×Ö¾90Â°.", answer:false, explain:"×œ× × ×›×•×Ÿ. ×—×“×” ×§×˜× ×” ×Ö¾90Â°." },
  { topic:"angles", text:"×–×•×•×™×ª ×§×”×” ×’×“×•×œ×” ×Ö¾90Â°.", answer:true, explain:"× ×›×•×Ÿ. ×§×”×” > 90Â°." },
  { topic:"triangles", text:"×‘××©×•×œ×© ×©×•×•×” ×¦×œ×¢×•×ª ×›×œ ×”×¦×œ×¢×•×ª ×©×•×•×ª.", answer:true, explain:"× ×›×•×Ÿ. 3 ×¦×œ×¢×•×ª ×©×•×•×ª." },
  { topic:"triangles", text:"×‘××©×•×œ×© ×©×•×•×” ×©×•×§×™×™× ×™×© ×©×ª×™ ×¦×œ×¢×•×ª ×©×•×•×ª.", answer:true, explain:"× ×›×•×Ÿ. 2 ×¦×œ×¢×•×ª ×©×•×•×ª." },
  { topic:"triangles", text:"×‘××©×•×œ×© ×©×•× ×” ×¦×œ×¢×•×ª ×›×œ ×”×¦×œ×¢×•×ª ×©×•× ×•×ª.", answer:true, explain:"× ×›×•×Ÿ. ×›×•×œ×Ÿ ×©×•× ×•×ª." }
];

// ×”×©×œ××ª ××™×œ×” ×‘××©×¤×˜ (×›×ª×™×‘×” ×§×¦×¨×”)
const FILL_BLANKS = [
  { topic:"angles", text:"×–×•×•×™×ª ×™×©×¨×” ×”×™× ____ ××¢×œ×•×ª.", answer:"90", explain:"×™×©×¨×” = 90Â°" },
  { topic:"angles", text:"×–×•×•×™×ª ×—×“×” ×”×™× ×§×˜× ×” ×Ö¾____ ××¢×œ×•×ª.", answer:"90", explain:"×—×“×” < 90Â°" },
  { topic:"angles", text:"×–×•×•×™×ª ×§×”×” ×”×™× ×’×“×•×œ×” ×Ö¾____ ××¢×œ×•×ª.", answer:"90", explain:"×§×”×” > 90Â°" },
  { topic:"triangles", text:"×‘××©×•×œ×© ×©×•×•×” ×¦×œ×¢×•×ª ×™×© ____ ×¦×œ×¢×•×ª ×©×•×•×ª.", answer:"3", explain:"3 ×¦×œ×¢×•×ª ×©×•×•×ª" },
  { topic:"triangles", text:"×‘××©×•×œ×© ×©×•×•×” ×©×•×§×™×™× ×™×© ____ ×¦×œ×¢×•×ª ×©×•×•×ª.", answer:"2", explain:"2 ×¦×œ×¢×•×ª ×©×•×•×ª" }
];

function poolByTopic(topic){
  if(topic==="angles") return [...ANGLES];
  if(topic==="triangles") return [...TRIANGLES];
  return [...ANGLES, ...TRIANGLES];
}

const el = (id)=>document.getElementById(id);

/* ---------- ××¦×‘ ---------- */
let score = 0, streak = 0;
let setSize = 20, topic = "mix";
let examMode = false;

let currentGame = null;
let questions = [], idx = 0, current = null;
let mistakes = []; // items ×œ×©×—×–×•×¨
let inMistakeReview = false;
let hintLevel = 0;
let hadWrongOnThisQuestion = false;

/* ---------- UI ---------- */
function show(which){
  el("learn").style.display = (which==="learn") ? "block" : "none";
  el("menu").style.display  = (which==="menu") ? "block" : "none";
  el("game").style.display  = (which==="game") ? "block" : "none";
  if(which==="menu") updateMistakeTip();
}

function updateHUD(){
  el("score").innerText = score;
  el("streak").innerText = streak;
  el("qnum").innerText = idx;
  el("qmax").innerText = questions.length;
  el("mist").innerText = mistakes.length;
}

function resetProgress(){
  score = 0; streak = 0; mistakes = [];
  updateHUD(); updateMistakeTip();
  alert("××™×¤×¡×ª×™ × ×™×§×•×“ ×•×˜×¢×•×™×•×ª ğŸ™‚");
}

function updateSetSize(){ setSize = parseInt(el("setSize").value, 10); }
function updateTopic(){ topic = el("topic").value; }
function updateExamMode(){ examMode = (el("examMode").value === "on"); }

function updateMistakeTip(){
  el("mistakeTip").innerText = mistakes.length
    ? `×™×© ${mistakes.length} ×©××œ×•×ª ×©×˜×¢×™×ª ×‘×”×Ÿ. ××•××œ×¥: â€œ×—×–×¨×•×ª ×¢×œ ×˜×¢×•×™×•×ªâ€.`
    : "××™×Ÿ ×¢×“×™×™×Ÿ ×˜×¢×•×™×•×ª ×œ×©×—×–×•×¨ â€” ×©×—×§×™ ×¡×˜ ×¨××©×•×Ÿ ğŸ™‚";
}

/* ---------- ×˜×¢×•×™×•×ª ---------- */
function addMistake(item){
  const key = JSON.stringify(item);
  if(!mistakes.some(m => JSON.stringify(m)===key)){
    mistakes.push(item);
  }
  updateMistakeTip();
}

/* ---------- ×¡×˜×™× ---------- */
function buildSet(game){
  if(game==="mcq" || game==="match" || game==="type"){
    const base = poolByTopic(topic);
    const set = [];
    for(let i=0;i<setSize;i++){
      const q = base[Math.floor(Math.random()*base.length)];
      set.push({ kind: game, data: q });
    }
    return set;
  }
  if(game==="tf"){
    const base = TRUE_FALSE.filter(x => topic==="mix" ? true : x.topic===topic);
    const set = [];
    for(let i=0;i<setSize;i++){
      const q = base[Math.floor(Math.random()*base.length)];
      set.push({ kind:"tf", data:q });
    }
    return set;
  }
  if(game==="fill"){
    const base = FILL_BLANKS.filter(x => topic==="mix" ? true : x.topic===topic);
    const set = [];
    for(let i=0;i<setSize;i++){
      const q = base[Math.floor(Math.random()*base.length)];
      set.push({ kind:"fill", data:q });
    }
    return set;
  }
  return [];
}

function startGame(game){
  inMistakeReview = false;
  currentGame = game;
  questions = buildSet(game);
  idx = 0;
  show("game");
  setupGameTitle();
  nextQuestion();
}

function startMistakeReview(){
  if(!mistakes.length){
    alert("××™×Ÿ ×›×¨×’×¢ ×˜×¢×•×™×•×ª ×œ×©×—×–×•×¨ ğŸ™‚ ×©×—×§×™ ×§×•×“× ×¡×˜ ××—×“.");
    return;
  }
  inMistakeReview = true;
  currentGame = "mistakes";
  questions = mistakes.map(m => ({...m}));
  idx = 0;
  show("game");
  setupGameTitle();
  nextQuestion();
}

function setupGameTitle(){
  const titles = {
    mcq:"1) ×œ×—×™×¦×”: ××” ×–×”? (×¨×‘Ö¾×‘×¨×™×¨×”)",
    tf:"2) ×œ×—×™×¦×”: × ×›×•×Ÿ / ×œ× × ×›×•×Ÿ",
    match:"3) ×œ×—×™×¦×”: ×”×ª×××” ×©× â†” ×¦×™×•×¨",
    type:"4) ×›×ª×™×‘×”: ×›×ª×‘×™ ××ª ×”×©×",
    fill:"5) ×›×ª×™×‘×”: ×”×©×œ×™××™ ××™×œ×” ×‘××©×¤×˜",
    mistakes:"6) ×—×–×¨×•×ª ×¢×œ ×˜×¢×•×™×•×ª"
  };
  el("gameTitle").innerText = titles[currentGame] || "××©×—×§";
}

function backToMenu(){ show("menu"); }

/* ---------- ×¢×–×¨ ---------- */
function shuffle(arr){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function setStatus(msg, ok=null){
  el("status").innerText = msg;
  if(ok===true) el("status").style.color = "#2da44e";
  else if(ok===false) el("status").style.color = "#d1242f";
  else el("status").style.color = "#111";
}

function renderChoices(buttons){
  const box = el("choices");
  box.innerHTML = "";
  buttons.forEach(b=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = b.text;
    btn.onclick = () => b.onClick();
    box.appendChild(btn);
  });
}

function normalizeHebrew(s){
  return (s||"")
    .trim()
    .replace(/\s+/g," ")
    .replace(/[×´"]/g,"")
    .replace(/Ö¾/g,"-")
    .toLowerCase();
}

/* ---------- ×©××œ×•×ª ---------- */
function showTyping(on){
  el("typingArea").style.display = on ? "block" : "none";
  el("choices").style.display = on ? "none" : "grid";
}

function setExamButtonsState(){
  const show = (!examMode) || hadWrongOnThisQuestion;
  el("hintBtn").style.display = show ? "inline-block" : "none";
  el("showBtn").style.display = show ? "inline-block" : "none";
  el("examNote").style.display = examMode ? "block" : "none";
}

function nextQuestion(){
  el("nextBtn").disabled = true;
  el("extraInfo").innerText = "";
  el("hintBox").innerText = "";
  hintLevel = 0;
  hadWrongOnThisQuestion = false;
  setStatus("");

  if(idx >= questions.length){
    setStatus("×¡×™×™××ª ××ª ×”×¡×˜! â­ï¸ ××•××œ×¥ ×¢×›×©×™×•: ×—×–×¨×•×ª ×¢×œ ×˜×¢×•×™×•×ª.", true);
    el("nextBtn").disabled = false;
    el("nextBtn").innerText = "×—×–×¨×” ×œ×ª×¤×¨×™×˜ ğŸ®";
    el("nextBtn").onclick = backToMenu;
    updateHUD();
    return;
  }

  el("nextBtn").innerText = "×©××œ×” ×”×‘××” â¡ï¸";
  el("nextBtn").onclick = nextQuestion;

  idx++;
  updateHUD();

  current = questions[idx-1];

  if(current.kind==="mcq" || current.kind==="match"){
    showTyping(false);
    const q = current.data;
    el("symbol").innerText = q.symbol;
    el("prompt").innerText = q.prompt;

    const base = poolByTopic(topic);
    const options = shuffle([q, ...shuffle(base.filter(x=>x.id!==q.id)).slice(0,2)]).map(o=>o.label);

    renderChoices(options.map(opt => ({
      text: opt,
      onClick: () => answerClick(opt, q.label, q.fact, current)
    })));

  } else if(current.kind==="tf"){
    showTyping(false);
    const q = current.data;
    el("symbol").innerText = "âœ…â“";
    el("prompt").innerText = q.text;

    renderChoices([
      { text:"× ×›×•×Ÿ", onClick: ()=>answerTF(true, q.answer, q.explain, current) },
      { text:"×œ× × ×›×•×Ÿ", onClick: ()=>answerTF(false, q.answer, q.explain, current) }
    ]);

  } else if(current.kind==="type"){
    showTyping(true);
    const q = current.data;
    el("symbol").innerText = q.symbol;
    el("prompt").innerText = "×›×ª×‘×™ ××ª ×”×©× ×”××“×•×™×§:";
    el("answerInput").value = "";
    el("answerInput").focus();
    setExamButtonsState();

  } else if(current.kind==="fill"){
    showTyping(true);
    const q = current.data;
    el("symbol").innerText = "âœï¸";
    el("prompt").innerText = q.text;
    el("answerInput").value = "";
    el("answerInput").focus();
    setExamButtonsState();
  }
}

/* ---------- ×ª×©×•×‘×•×ª ---------- */
function finalizeAnswer(correct, explain){
  if(correct){
    score += 1; streak += 1;
    setStatus("â­ï¸ ×›×œ ×”×›×‘×•×“! " + explain, true);
  } else {
    streak = 0;
    setStatus("âŒ ×›××¢×˜! " + explain, false);
  }
  updateHUD();
  el("nextBtn").disabled = false;
}

function answerClick(chosen, right, fact, item){
  const correct = (chosen === right);
  if(!correct) addMistake(item);
  finalizeAnswer(correct, `(${fact})`);
}

function answerTF(chosen, right, explain, item){
  const correct = (chosen === right);
  if(!correct) addMistake(item);
  finalizeAnswer(correct, explain);
}

/* ---------- ×›×ª×™×‘×” ---------- */
function currentRightAnswer(){
  if(current.kind==="type") return current.data.label;
  if(current.kind==="fill") return String(current.data.answer);
  return "";
}

function submitTyped(){
  const right = currentRightAnswer();
  const typed = el("answerInput").value;

  const ok = normalizeHebrew(typed) === normalizeHebrew(right);

  if(!ok){
    addMistake(current);
    hadWrongOnThisQuestion = true;
    setExamButtonsState();
  }

  const explain = (current.kind==="type")
    ? `×”×ª×©×•×‘×”: ${right}. (${current.data.fact})`
    : `×”×ª×©×•×‘×”: ${right}. (${current.data.explain})`;

  finalizeAnswer(ok, explain);
}

function giveHint(){
  if(examMode && !hadWrongOnThisQuestion) return;
  const right = currentRightAnswer();
  hintLevel++;

  if(hintLevel===1){
    el("hintBox").innerText = `×¨××–: ×–×” ××ª×—×™×œ ×‘Ö¾ "${right.trim().slice(0,1)}"`;
  } else if(hintLevel===2){
    el("hintBox").innerText = `×¨××–: ×–×” ××ª×—×™×œ ×‘Ö¾ "${right.trim().slice(0,2)}"`;
  } else {
    el("hintBox").innerText = `×¨××–: ××•×¨×š ×”×ª×©×•×‘×” ×”×•× ${right.trim().length} ×ª×•×•×™×`;
  }
}

function showAnswer(){
  if(examMode && !hadWrongOnThisQuestion) return;
  const right = currentRightAnswer();
  el("answerInput").value = right;
  el("hintBox").innerText = "×”×¦×’×ª×™ ××ª ×”×ª×©×•×‘×” â€” ×¢×›×©×™×• ×œ×—×¦×™ ×‘×“×™×§×” ×›×“×™ ×œ×§×‘×¢ ğŸ™‚";
}

/* ---------- ×”×ª×—×œ×” ---------- */
updateSetSize();
updateTopic();
updateExamMode();
show("menu");
updateHUD();

// Enter ×œ×©×œ×™×—×”
document.addEventListener("keydown", (e)=>{
  if(e.key==="Enter" && document.getElementById("typingArea").style.display!=="none"){
    submitTyped();
  }
});
</script>
</body>
</html>
